{% extends 'base.html.twig' %}

{% set successMessages = app.flashes('success') %}

{% block body %}

<section class="contact-hero" style="background: url('{{ asset('images/contactpage.jpg') }}') center/cover no-repeat;">
  <div class="contact-hero-content">
    <h1>Conception de votre √©v√©nement</h1>
    <p>Parlez-moi de votre projet culinaire ‚Äî je vous r√©ponds rapidement.</p>
  </div>
</section>

<section class="contact-section">
  <div class="contact-flex">
    <!-- Bloc gauche : photo + texte -->
    <div class="contact-left">
      <img src="{{ asset('images/chef.jpg') }}" alt="Photo du chef">
      <div class="contact-left-content">
        <h2>Entrons en contact</h2>
        <p>
          Que ce soit pour un d√Æner priv√©, un mariage ou un √©v√©nement d‚Äôentreprise, 
          je serai ravi d‚Äô√©changer avec vous pour cr√©er une exp√©rience sur mesure.
        </p>
         <p class="contact-alt">
            Vous pouvez aussi me contacter sur Instagram.
        </p>
        <div class="contact-details">
          <p>üìç Bas√© √† Rochefort ‚Äî D√©placements sur demande</p>
          <p>üì∏ <a href="https://www.instagram.com/nicolasprivatechef" target="_blank">Instagram</a></p>
        </div>
      </div>
    </div>
    <!-- Bloc droit : formulaire -->
    <div class="contact-form-container">
      <h3>Envoyez-moi un message</h3>
      {{ form_start(form, {
        'action': path('contact') ~ '#contact-section',
        'attr': {
            'class': 'contact-form',
            'id': 'contact-section',
            'novalidate': 'novalidate',
            'data-turbo': 'false'
        } }) }}
      <div class="form-group">
        <label for="name">Votre nom complet</label>
        {{ form_widget(form.name) }}
        <div class="error-message">
        {{ form_errors(form.name) }}
        </div>  
      </div>
      
      <div class="form-group">
        <label for="email">Adresse e-mail</label>
        {{ form_widget(form.email) }}
        <div class="error-message">
          {{ form_errors(form.email) }}
        </div>
      </div>
      

      <div class="form-group">
        <label for="phone">T√©l√©phone</label>
        {{ form_widget(form.phone) }}
        <div class="error-message">
          {{ form_errors(form.phone) }}
        </div>
      </div>
      

      <div class="form-group">
        <label for="message">Comment puis-je vous aider ?</label>
        {{ form_widget(form.message) }}
        <div class="error-message">
          {{ form_errors(form.message) }}
        </div>
      </div>
      
      {{ form_rest(form) }}
      <button type="submit" class="btn-submit">Envoyer le message</button>
    {{ form_end(form) }}
      
    </div>
  </div>
</section>

<div id="success-popup" class="popup">
  <div class="popup-content">
    <p>Merci de m'avoir contact√©, je vous r√©pondrai rapidement.</p>
    <button id="close-popup">Fermer</button>
  </div>
</div>

<script>

const popup = document.getElementById('success-popup');
const closeBtn = document.getElementById('close-popup');

const urlParams = new URLSearchParams(window.location.search);
if (urlParams.get('success') === '1') {
  popup.style.display = 'flex';
}

closeBtn.addEventListener('click', function() {
  popup.style.display = 'none';
  const newUrl = window.location.origin + window.location.pathname + '#flashmessage';
  window.history.replaceState({}, document.title, newUrl);
});

document.addEventListener('DOMContentLoaded', function() {
  
  const firstError = document.querySelector('.invalid-feedback');

  if (firstError) {

    const form = document.getElementById('contact-section');
    
    if (form) {
      setTimeout(() => {
          form.scrollIntoView({ 
              behavior: 'smooth',
              block: 'start'
          });
      }, 100);
    }
  }
});

</script>

{% endblock %}